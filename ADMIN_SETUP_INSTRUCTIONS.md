# تعليمات إنشاء حساب المدير

## البيانات المطلوبة

```
الاسم:         محمد ابو طير
البريد:        info@wefrh.com
الهاتف:        0595579036
كلمة المرور:   Mo%+%05990
```

## الطريقة الموصى بها: عبر Supabase Dashboard

### الخطوات:

1. **افتح Supabase Dashboard**
   ```
   https://lyjdqdopnbeikajifaks.supabase.co
   ```

2. **اذهب إلى SQL Editor**
   - من القائمة الجانبية، اختر "SQL Editor"
   - أو استخدم الرابط المباشر: Dashboard → SQL Editor

3. **افتح الملف وانسخ محتواه**
   - افتح الملف: `create_admin_account.sql`
   - حدد كل المحتوى وانسخه (Ctrl+A ثم Ctrl+C)

4. **الصق في SQL Editor**
   - الصق المحتوى في SQL Editor
   - تأكد من نسخ الملف كاملاً

5. **شغل الـ Script**
   - اضغط على زر "Run" أو اضغط `Ctrl+Enter`
   - انتظر حتى ينتهي التنفيذ

6. **تحقق من النتيجة**
   - يجب أن ترى رسائل NOTICE تؤكد إنشاء الحساب
   - يجب أن ترى جدول بمعلومات المستخدم المنشأ

## ما يفعله الـ Script:

1. ✅ تعطيل الـ Trigger مؤقتاً (لإنشاء الحساب بدون قيود)
2. ✅ حذف أي بيانات عالقة قديمة للبريد info@wefrh.com
3. ✅ إنشاء حساب في Supabase Auth بكلمة المرور المشفرة
4. ✅ إنشاء سجل في جدول system_users مع ربطه بـ Auth
5. ✅ التحقق من وجود دور "مدير النظام" أو إنشائه
6. ✅ إعادة تفعيل الـ Trigger (لمنع إنشاء حسابات إضافية)
7. ✅ عرض معلومات الحساب المنشأ

## بعد التنفيذ الناجح:

1. ✅ يمكنك تسجيل الدخول مباشرة باستخدام:
   - البريد: `info@wefrh.com`
   - كلمة المرور: `Mo%+%05990`

2. ✅ الحساب سيكون نشطاً وجاهزاً للاستخدام

3. ✅ لن يمكن إنشاء حسابات جديدة عبر صفحة التسجيل بعد الآن

## طرق بديلة (إذا لزم الأمر):

### عبر psql:
```bash
psql "postgresql://postgres.[PROJECT-REF]:[PASSWORD]@aws-0-eu-central-1.pooler.supabase.com:6543/postgres" \
  -f create_admin_account.sql
```

### عبر Supabase CLI:
```bash
supabase db execute --file create_admin_account.sql
```

## استكشاف الأخطاء:

### إذا ظهر خطأ في التشفير:
- تأكد من أن extension `pgcrypto` مفعلة
- شغل هذا الأمر أولاً: `CREATE EXTENSION IF NOT EXISTS pgcrypto;`

### إذا ظهر خطأ في الدور:
- الـ Script سينشئ الدور تلقائياً إذا لم يكن موجوداً

### إذا ظهر خطأ في الصلاحيات:
- تأكد من أنك تستخدم حساب له صلاحيات الـ admin في Supabase

## الأمان:

- ✅ كلمة المرور مشفرة باستخدام bcrypt
- ✅ الـ Trigger سيمنع إنشاء حسابات إضافية تلقائياً
- ✅ يُنصح بتغيير كلمة المرور بعد أول تسجيل دخول
- ✅ الحساب مرتبط بـ Supabase Auth للأمان الكامل

## ملاحظات مهمة:

1. هذا الـ Script آمن للتشغيل وسيحذف أي بيانات عالقة قديمة
2. سيتم تعطيل الـ Trigger مؤقتاً فقط أثناء التنفيذ
3. بعد التنفيذ، ستعود جميع الحمايات للعمل
4. هذا هو الحساب الوحيد الذي يمكن إنشاؤه بهذه الطريقة

## الدعم:

إذا واجهت أي مشكلة:
1. تأكد من نسخ الـ Script كاملاً
2. تحقق من رسائل الخطأ في SQL Editor
3. تأكد من أن قاعدة البيانات متصلة وتعمل
